 /*
  * 
  * MADos, a free OS for N* handsets  
  * Copyright (C) 2003/2004 MADos Core Developer Team  
  * 
  * This library is free software; you can redistribute it and/or  
  * modify it under the terms of the GNU Lesser General Public  
  * License as published by the Free Software Foundation; either  
  * version 2.1 of the License, or (at your option) any later version.  
  * 
  * This library is distributed in the hope that it will be useful,  
  * but WITHOUT ANY WARRANTY; without even the implied warranty of  
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU  
  * Lesser General Public License for more details.  
  * 
  * You should have received a copy of the GNU Lesser General Public  
  * License along with this library; if not, write to the Free Software  
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA  
  * 
  * contact http://64.246.26.121/forum/forumdisplay.php?f=99  
  * 
  */

#include <hw/lcd.h>
#include <core/ui.h>
#include <hw/kpd.h>
#include <core/lib.h>


void
hangman_main ( void )
{
    unsigned char tries = 0, c, d, e, f, key, option = 0;
    signed char tried_chars[30], current_string[30], buf[2];
    unsigned int current_word = 0, elements = 0, current_word_len;

    bitmap_t hangman_bmp;
    hangman_bmp.x = 40;
    hangman_bmp.y = 24;

    static const char hangman_bitmaps[10][0x78] = {
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0x80, 0x80, 0xC0, 0x00, 0xC0, 0x00, 0xC0, 0xC0, 0x80, 0x80, 0xC0, 0x40,
         0x80, 0xC0, 0x40, 0x80, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC2, 0x82, 0x82, 0xC6, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0xFC, 0xD8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xD9, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0x01,
         0x02, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xF9, 0x63, 0x73, 0x7B, 0x3F, 0x0F, 0x07, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0x01,
         0x02, 0x03, 0x03, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xF9, 0x63, 0x73, 0x7B, 0x3F, 0x0F, 0x07, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0x3D,
         0xFA, 0x93, 0x93, 0xB1, 0xE1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xF9, 0x63, 0x73, 0x7B, 0x3F, 0x0F, 0x07, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0xBD,
         0xFA, 0x93, 0x93, 0xB1, 0xE1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x7F, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xF9, 0x63, 0x73, 0x7B, 0x3F, 0x0F, 0x07, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0xBD,
         0xFA, 0x93, 0x93, 0xB1, 0xE1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x01, 0x02, 0x06, 0x7F, 0x05, 0x0C, 0x08, 0x08, 0x08, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x03,
         0x01, 0xFF, 0xF9, 0x63, 0x73, 0x7B, 0x3F, 0x0F, 0x07, 0x03, 0x03, 0x03, 0x01, 0x03, 0x03, 0x03, 0xBD,
         0xFA, 0x93, 0x93, 0xB1, 0xE1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xEF, 0xFF, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x01, 0x82, 0x86, 0xFF, 0x05, 0x0C, 0x08, 0x08, 0x08, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80,
         0x80, 0xC0, 0x80, 0x00, 0x40, 0xC0, 0xF0, 0xD8, 0x08, 0xCC, 0x04, 0xC6, 0xC3, 0x83, 0x83, 0xC7, 0x44,
         0x84, 0xC4, 0x4C, 0xB8, 0x40, 0x80, 0x86, 0x83, 0x81, 0x80, 0x81, 0x01, 0x83, 0x86, 0x80, 0x80, 0x80,
         0x80},
        {
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0xC4,
         0x06, 0x38, 0x40, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x60, 0x90, 0x08, 0x48, 0x28, 0x29, 0xAE, 0xC0, 0x00, 0x00, 0x01, 0x02, 0x0C, 0x18, 0x10, 0x10, 0x10,
         0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x0D, 0x15, 0x35, 0x55, 0x54, 0x4A, 0x6B, 0x7C, 0x50,
         0x20, 0x20, 0x10, 0x08, 0x08, 0x08, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00}

    };


    static const char *wordlist[] = {
        "nokia", "mados", "hangman", "keypad", "elephant", "labour", "school",
        "mouse", "snake", "printer", "glass", "house", "chicken", "fork", "script",
        "ocean", "europe", "newspaper", "president", "water", "bottle", "pirate",
        "face", "present", "weapon", "digital", "castle", "forest", "cigarette",
        "skirt", "blizzard", "pictures", "appendix", "house", "dragon", "dungeon",
        "internet", "directory", "creature", "adventure", "\xFF"
    };


    while ( ( unsigned char ) wordlist[elements][0] != 0xff )
        elements++;

    do
    {
        if ( option != 3 )
        {
            current_word = lib_mod ( lib_rand ( elements ), elements );
            current_word_len = strlen ( wordlist[current_word] );
        }

        memset ( tried_chars, 0, sizeof ( tried_chars ) );
        tries = 0;
        option = 0;

        do
        {

            memset ( current_string, 0, sizeof ( current_string ) );

            for ( c = 0; c < current_word_len; c++ )
            {
                e = 0;
                for ( d = 0; d < sizeof ( tried_chars ); d++ )
                {
                    if ( tried_chars[d] == wordlist[current_word][c] )
                    {
                        e = 1;
                        break;
                    }
                }
                if ( e )
                    current_string[c] = wordlist[current_word][c];
                else
                    current_string[c] = '.';
            }

            if ( ( !option && !strcmp ( wordlist[current_word], current_string ) ) || ( tries == 8 && !option ) )
                option++;

            if ( !strcmp ( wordlist[current_word], current_string ) )
                hangman_bmp.data = hangman_bitmaps[9];
            else
                hangman_bmp.data = hangman_bitmaps[tries];

            lcd_clr (  );


            lcd_draw_bitmap ( -1, 0, &hangman_bmp );
            //lcd_render_text ( 0, 8, "..pics.. here", 1 );
            //sprintf ( buf, "%d\x00", tries );
            //lcd_render_text ( 0,0, buf, 1 );



            lcd_render_text ( ( 84 - lcd_get_text_width ( current_string ) ) / 2, 24, current_string, 1 );
            lcd_render_text ( ( 84 - lcd_get_text_width ( tried_chars ) ) / 2, 32, tried_chars, 1 );
            switch ( option )
            {
                case 0x0:
                    lcd_render_text ( ( 84 - lcd_get_text_width ( "guess char" ) ) / 2, 40, "guess char", 1 );
                    break;
                case 0x1:
                    lcd_render_text ( ( 84 - lcd_get_text_width ( "new word" ) ) / 2, 40, "new word", 1 );
                    break;
                case 0x2:
                    lcd_render_text ( ( 84 - lcd_get_text_width ( "exit" ) ) / 2, 40, "exit", 1 );
                    break;
                case 0x3:
                    lcd_render_text ( ( 84 - lcd_get_text_width ( "new try" ) ) / 2, 40, "new try", 1 );
                    break;
                default:
                    break;
            }


            lcd_to_screen (  );
            kpd_wait_release (  );

            kpd_wait_keypress (  );
            //kpd_wait_release ( );
            key = kpd_getkey (  );
            kpd_wait_release (  );

            if ( key == KPD_DWNARROW )
                option = lib_mod ( option + 1, 4 );
            if ( ( !strcmp ( wordlist[current_word], current_string ) && !option ) || ( tries == 8 && !option ) )
                option++;
            if ( key == KPD_UPARROW )
                option = lib_mod ( option + 3, 4 );
            if ( ( !strcmp ( wordlist[current_word], current_string ) && !option ) || ( tries == 8 && !option ) )
                option = lib_mod ( option + 3, 4 );

            if ( key == KPD_SOFTBTN1 && !option && strcmp ( wordlist[current_word], current_string ) )
            {
                buf[0] = 0;
                ui_gettext ( "guess char", 1, buf, UI_TYPE_LOWERCASE );

                c = 0;
                e = 0;
                for ( d = 0; d < sizeof ( tried_chars ); d++ )
                {
                    if ( !e )

                        for ( f = 0; f < current_word_len; f++ )
                            if ( wordlist[current_word][f] == buf[0] /*|| wordlist[current_word][f] == tried_chars[d] */  )
                                e = 1;
                    if ( tried_chars[d] == 0x00 )
                    {
                        if ( !c )
                        {
                            tried_chars[d] = buf[0];
                            if ( buf[0] && !e )
                                tries++;
                        }
                        break;
                    }
                    if ( tried_chars[d] == buf[0] )
                        c = 1;
                }
            }

            //c = ( option != 1 && option != 2 key != KPD_SOFTBTN1);
        }
        while ( option == 0 || key != KPD_SOFTBTN1 );

    }
    while ( key != KPD_SOFTBTN1 || option != 2 );

}
